---
tags: ,C-TestHarness,Good-first-issue,T-task
title: "Potential bug could occur in deletion of files in test harness"
html_url: "https://github.com/idaholab/moose/issues/23749"
user: permcody
repo: idaholab/moose
---

## Reason
<!--Why do you need this feature or what is the enhancement?-->

We've had an input parameter in the TestHarness Testers hierarchy for several years that will skip the normal deletion of expected output files (from that test) prior to running that test. This parameter exists mostly for the case where an output may need to be used in multiple tests or is expensive to generate more than once, etc. 

The issue is that in extreme circumstances, never clearing out output files can obscure bugs where the output is no longer being generated but the file exists so it's not being detected by the TestHarness.

For the most part, this condition is safely mitigated by the continuous integration system since we start with a clean checkout before running the tests so leftovers cannot feed into the testing process. However, there is a remote chance that not cleaning these out in the development environment at least occasionally could lead to issues that seem to only arise in the CI system. 

## Design
<!--A concise description (design) of the enhancement.--->

We already had a parameter called `delete_output_before_running` in the `RunApp` class (probably should be in the FileTester class, but that's where it's currently located). When the parameter is set to false, we normally don't delete the expected outputs before running. I'm proposing that we modify that logic slightly so that when that parameter is set, we delete output _after_ the test runs instead of before. This shouldn't have any effect on any tests we have in the system now. Altenatively, we could create an enumeration instead of a Boolean: `delete_output = BEFORE | AFTER`. Defaulting to before for the 99% case. Again, the thinking is that in the rare cases where we don't want to delete before, it's because we are working with an expensive to generate file or one where we want to run a separate tester to process. In those rare cases, cleaning up the output after that tester could help alleviate any problems one might encounter.

Design 2: A completely different design might be to delete extra files before running the first part of a multi-part test:
- Test A generates output "out_a"
- Test B processes output "out_a" so we can't delete that file before processing it (current behavior).

Test A could be modified to delete "out_a" something it likely doesn't do automatically since it usually isn't processing "out_a", we could just make this explicit... but this could be error prone.

## Impact
<!--Will the enhancement change existing APIs or add something new?-->

Very minor - but falls into the "don't say I didn't think about this super obscure error that really should never bite anyone, but then of course does because you know... chaos is a b****"