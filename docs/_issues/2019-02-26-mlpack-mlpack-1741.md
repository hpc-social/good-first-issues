---
tags: ,c-build-system,c-testing,s-keep-open,t-added-feature
title: "CI testing with different random seeds"
html_url: "https://github.com/mlpack/mlpack/issues/1741"
user: rcurtin
repo: mlpack/mlpack
---

#1740 is just one of many issues we've had over the years where something gets committed to master and then shortly thereafter the CI tests start failing intermittently because the new tests aren't resilient to different random seeds.

I thought about it today because I have spent a lot of time over the years debugging problems like this, and I realized we can handle it more automatically.  But what we'll need to do is set up a Jenkins job that can do the following:

 * Look at the diff of a PR to extract any new or modified test cases (these are denoted with `BOOST_AUTO_TEST_CASE()`).
 * Compile `mlpack_test` with some way to set `mlpack::math::RandomSeed(std::time(NULL))` at the beginning of running tests.  Maybe https://www.boost.org/doc/libs/1_60_0/libs/test/doc/html/boost_test/tests_organization/fixtures/global.html is the way to go here.
 * Run each of those modified test cases 1000 times, and output this into an .xml file that can later be parsed by Jenkins to print any failing tests.

We should do this as a bash script or something (I guess Python is fine too) that can be run from the inside of a Jenkins job, so once a script works, we can add it to the jenkins-conf/ repository and then I can set it up inside of Jenkins.  (In fact, go ahead and open a PR there---but I've opened the issue here so it gets some visibility.)

Basically, for this to work right, as input you will get a git repository, which you can then compare with (or rebase on) the mlpack git master branch, and as output, we should get a big unified Boost.Test XML that contains the results of 1000 runs of any new or modified tests that Jenkins can parse.

You can see how Jenkins currently runs the mlpack tests here:

https://github.com/mlpack/jenkins-conf/blob/master/runTestBins.sh

That should help with the options used to get output in the right format.