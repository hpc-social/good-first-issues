---
tags: ,enhancement,scipy.sparse
title: "Comparison operator overloading doesn't work with sparse matrices"
html_url: "https://github.com/scipy/scipy/issues/4819"
user: SteveDiamond
repo: scipy/scipy
---

I'm the developer of a modeling framework for optimization problems called cvxpy. I'd like to support operator overloading between scipy sparse matrices and cvxpy objects.

Currently operator overloading works for arithmetic operations, but I also need it to work for comparison operators. The issue is that all comparison operators route through the `_inequality` function in `scipy/sparse/compressed.py`, and there's no code path in that function that returns `NotImplemented`. 

Could you add some code path that returns `NotImplemented` like in the arithmetic operators? That way the reflection will be called on the cvxpy object. For example, if `A` is a sparse matrix and `x` is a cvxpy variable, the expression `A <= x` will first call `A.__le__(x)`. This needs to return `NotImplemented` so Python calls `x.__ge__(A)`, which creates a cvxpy constraint object.

The same issues apply to the `__eq__` method in `scipy/sparse/compressed.py`. There should be some code path that returns `NotImplemented`.

Another solution would be to check `__array_priority__` like in Numpy. The object with the higher `__array_priority__` would have its comparison operator called first.
