---
tags: BUG
title: "ptrace() Qobj method returns a ket if no subsystem is traced out"
html_url: "https://github.com/qutip/qutip/issues/2129"
user: udevd
repo: qutip/qutip
---

### Bug Description

When trying to perform a trivial partial trace (of a ket) when no subsystem is traced over (all subsystems are kept), the result is a ket.

### Code to Reproduce the Bug

```shell
from qutip import tensor,basis
psi = tensor(basis(2, 0), basis(2, 1))
print(psi.ptrace([0,1]))
```


### Code Output

```shell
Quantum object: dims = [[2, 2], [1, 1]], shape = (4, 1), type = ket
Qobj data =
[[0.]
 [1.]
 [0.]
 [0.]]
```


### Expected Behaviour

A density operator should be returned for consistency. The documentation (https://qutip.org/docs/latest/guide/guide-tensor.html) also mentions that: 

> Note that the partial trace always results in a density matrix (mixed state), regardless of whether the composite system is a pure state (described by a state vector) or a mixed state (described by a density matrix)

### Your Environment

```shell
QuTiP version: 4.7.1
```


### Additional Context

The issue seems to originate in _ptrace_dense (see https://qutip.org/docs/latest/modules/qutip/qobj.html), where the following code appears:
```
    if not dtrace:
        # If we are keeping all dimensions, no need to construct an ndarray.
        return Q.copy()
```
A projector onto the state should be returned here instead of the copy of the state.