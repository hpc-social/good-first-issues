---
tags: ,code-fix,contribution-welcome
title: "Use `__future__.annotations` everywhere in the Optuna code base"
html_url: "https://github.com/optuna/optuna/issues/4508"
user: HideakiImamura
repo: optuna/optuna
---

### Motivation

Optuna drops Python 3.6 from v3.1, so we can use `__future__.annotations`, which simplifies the code base. See [PEP 563](https://peps.python.org/pep-0563/), [PEP 585](https://peps.python.org/pep-0585/), and [PEP 604](https://peps.python.org/pep-0604/) for more details. This issue suggests to use the module and simplifies the code base.

### Suggestion

Use `__future__.annotations` for each file and simplify the type annotations. The list of classes whose type annotations can be simplified is [here](https://peps.python.org/pep-0585/#implementation). The list of files where the `__future__.annotations` can be used is as follows. In order to reduce review costs and to encourage more contributors to work on it, please, as a rule, fix one file per PR.

- [ ] optuna/_convert_positional_args.py
- [ ] optuna/visualization/_parallel_coordinate.py
- [ ] optuna/visualization/_optimization_history.py
- [ ] optuna/visualization/_intermediate_values.py
- [ ] optuna/visualization/_slice.py
- [ ] optuna/visualization/_edf.py
- [ ] optuna/visualization/_pareto_front.py
- [ ] optuna/visualization/matplotlib/_parallel_coordinate.py
- [ ] optuna/visualization/matplotlib/_optimization_history.py
- [ ] optuna/visualization/matplotlib/_slice.py
- [ ] optuna/visualization/matplotlib/_edf.py
- [ ] optuna/visualization/matplotlib/_pareto_front.py
- [ ] optuna/visualization/matplotlib/_param_importances.py
- [ ] optuna/visualization/matplotlib/_utils.py
- [ ] optuna/visualization/matplotlib/_contour.py
- [ ] optuna/visualization/_param_importances.py
- [ ] optuna/visualization/_utils.py
- [ ] optuna/visualization/_contour.py
- [ ] optuna/logging.py
- [ ] optuna/storages/_base.py
- [ ] optuna/storages/_cached_storage.py
- [ ] optuna/storages/__init__.py
- [ ] optuna/storages/_heartbeat.py
- [ ] optuna/storages/_in_memory.py
- [ ] optuna/storages/_rdb/models.py
- [ ] optuna/storages/_rdb/storage.py
- [ ] optuna/storages/_rdb/alembic/versions/v3.0.0.c.py
- [ ] optuna/storages/_rdb/alembic/versions/v3.0.0.d.py
- [ ] optuna/storages/_rdb/alembic/versions/v3.0.0.a.py
- [ ] optuna/storages/_journal/file.py
- [ ] optuna/storages/_journal/redis.py
- [ ] optuna/storages/_journal/storage.py
- [ ] optuna/storages/_journal/base.py
- [ ] optuna/study/_dataframe.py
- [ ] optuna/study/_optimize.py
- [ ] optuna/study/_tell.py
- [ ] optuna/study/_multi_objective.py
- [ ] optuna/study/_frozen.py
- [ ] optuna/study/study.py
- [ ] optuna/study/_study_summary.py
- [ ] optuna/_deprecated.py
- [ ] optuna/pruners/_hyperband.py
- [ ] optuna/pruners/_patient.py
- [ ] optuna/pruners/_successive_halving.py
- [ ] optuna/pruners/_percentile.py
- [ ] optuna/pruners/_threshold.py
- [ ] optuna/trial/_base.py
- [ ] optuna/trial/_fixed.py
- [ ] optuna/trial/_trial.py
- [ ] optuna/trial/_frozen.py
- [ ] optuna/integration/cma.py
- [ ] optuna/integration/shap.py
- [ ] optuna/integration/lightgbm.py
- [ ] optuna/integration/pytorch_distributed.py
- [ ] optuna/integration/_lightgbm_tuner/optimize.py
- [ ] optuna/integration/_lightgbm_tuner/alias.py
- [ ] optuna/integration/chainermn.py
- [ ] optuna/integration/mlflow.py
- [ ] optuna/integration/keras.py
- [ ] optuna/integration/wandb.py
- [ ] optuna/integration/allennlp/_pruner.py
- [ ] optuna/integration/allennlp/_environment.py
- [ ] optuna/integration/allennlp/_executor.py
- [ ] optuna/integration/catboost.py
- [ ] optuna/integration/skopt.py
- [ ] optuna/integration/botorch.py
- [ ] optuna/integration/dask.py
- [ ] optuna/integration/sklearn.py
- [ ] optuna/integration/tfkeras.py
- [ ] optuna/integration/tensorboard.py
- [ ] optuna/terminator/callback.py
- [ ] optuna/terminator/terminator.py
- [ ] optuna/terminator/_search_space/intersection.py
- [ ] optuna/terminator/improvement/_preprocessing.py
- [ ] optuna/terminator/improvement/gp/botorch.py
- [ ] optuna/terminator/improvement/gp/base.py
- [ ] optuna/terminator/improvement/evaluator.py
- [ ] optuna/importance/_base.py
- [ ] optuna/importance/_mean_decrease_impurity.py
- [ ] optuna/importance/__init__.py
- [ ] optuna/importance/_fanova/_fanova.py
- [ ] optuna/importance/_fanova/_evaluator.py
- [ ] optuna/importance/_fanova/_tree.py
- [ ] optuna/_imports.py
- [ ] optuna/testing/threading.py
- [ ] optuna/testing/distributions.py
- [ ] optuna/testing/samplers.py
- [ ] optuna/testing/storages.py
- [ ] optuna/distributions.py
- [ ] optuna/cli.py
- [ ] optuna/multi_objective/visualization/_pareto_front.py
- [ ] optuna/multi_objective/trial.py
- [ ] optuna/multi_objective/samplers/_base.py
- [ ] optuna/multi_objective/samplers/_nsga2.py
- [ ] optuna/multi_objective/samplers/_adapter.py
- [ ] optuna/multi_objective/samplers/_random.py
- [ ] optuna/multi_objective/samplers/_motpe.py
- [ ] optuna/multi_objective/study.py
- [ ] optuna/_experimental.py
- [ ] optuna/samplers/_base.py
- [ ] optuna/samplers/nsgaii/_crossovers/_undx.py
- [ ] optuna/samplers/nsgaii/_crossovers/_spx.py
- [ ] optuna/samplers/nsgaii/_crossovers/_sbx.py
- [ ] optuna/samplers/nsgaii/_crossovers/_vsbx.py
- [ ] optuna/samplers/nsgaii/_sampler.py
- [ ] optuna/samplers/nsgaii/_crossover.py
- [ ] optuna/samplers/_search_space/group_decomposed.py
- [ ] optuna/samplers/_search_space/intersection.py
- [ ] optuna/samplers/_qmc.py
- [ ] optuna/samplers/_tpe/_truncnorm.py
- [ ] optuna/samplers/_tpe/multi_objective_sampler.py
- [ ] optuna/samplers/_tpe/parzen_estimator.py
- [ ] optuna/samplers/_tpe/sampler.py
- [ ] optuna/samplers/_random.py
- [ ] optuna/samplers/_cmaes.py
- [ ] optuna/samplers/_partial_fixed.py
- [ ] optuna/samplers/_brute_force.py
- [ ] optuna/samplers/_grid.py
- [ ] optuna/_hypervolume/wfg.py
- [ ] optuna/_hypervolume/hssp.py
- [ ] optuna/progress_bar.py
- [ ] optuna/_transform.py
- [ ] optuna/_callbacks.py
- [ ] tests/multi_objective_tests/test_study.py
- [ ] tests/multi_objective_tests/samplers_tests/test_motpe.py
- [ ] tests/multi_objective_tests/samplers_tests/test_nsga2.py
- [ ] tests/multi_objective_tests/test_trial.py
- [ ] tests/multi_objective_tests/visualization_tests/test_pareto_front.py
- [ ] tests/trial_tests/test_frozen.py
- [ ] tests/trial_tests/test_trials.py
- [ ] tests/trial_tests/test_trial.py
- [ ] tests/pruners_tests/test_percentile.py
- [ ] tests/pruners_tests/test_median.py
- [ ] tests/pruners_tests/test_patient.py
- [ ] tests/pruners_tests/test_successive_halving.py
- [ ] tests/study_tests/test_optimize.py
- [ ] tests/study_tests/test_study.py
- [ ] tests/study_tests/test_dataframe.py
- [ ] tests/hypervolume_tests/test_hssp.py
- [ ] tests/integration_tests/test_skopt.py
- [ ] tests/integration_tests/test_pytorch_lightning.py
- [ ] tests/integration_tests/allennlp_tests/test_allennlp.py
- [ ] tests/integration_tests/allennlp_tests/tiny_single_id.py
- [ ] tests/integration_tests/test_shap.py
- [ ] tests/integration_tests/test_cma.py
- [ ] tests/integration_tests/test_pytorch_distributed.py
- [ ] tests/integration_tests/test_chainermn.py
- [ ] tests/integration_tests/lightgbm_tuner_tests/test_optimize.py
- [ ] tests/integration_tests/lightgbm_tuner_tests/test_alias.py
- [ ] tests/integration_tests/test_botorch.py
- [ ] tests/integration_tests/test_mlflow.py
- [ ] tests/integration_tests/test_mxnet.py
- [ ] tests/integration_tests/test_wandb.py
- [ ] tests/importance_tests/fanova_tests/test_tree.py
- [ ] tests/importance_tests/test_mean_decrease_impurity.py
- [ ] tests/importance_tests/test_fanova.py
- [ ] tests/importance_tests/test_init.py
- [ ] tests/test_convert_positional_args.py
- [ ] tests/test_deprecated.py
- [ ] tests/storages_tests/test_journal.py
- [ ] tests/storages_tests/test_heartbeat.py
- [ ] tests/storages_tests/test_storages.py
- [ ] tests/storages_tests/rdb_tests/test_storage.py
- [ ] tests/storages_tests/rdb_tests/create_db.py
- [ ] tests/samplers_tests/test_grid.py
- [ ] tests/samplers_tests/tpe_tests/test_parzen_estimator.py
- [ ] tests/samplers_tests/tpe_tests/test_multi_objective_sampler.py
- [ ] tests/samplers_tests/tpe_tests/test_sampler.py
- [ ] tests/samplers_tests/test_cmaes.py
- [ ] tests/samplers_tests/test_samplers.py
- [ ] tests/samplers_tests/test_nsgaii.py
- [ ] tests/samplers_tests/test_qmc.py
- [ ] tests/test_distributions.py
- [ ] tests/test_multi_objective.py
- [ ] tests/test_cli.py
- [ ] tests/visualization_tests/test_edf.py
- [ ] tests/visualization_tests/test_parallel_coordinate.py
- [ ] tests/visualization_tests/test_param_importances.py
- [ ] tests/visualization_tests/test_slice.py
- [ ] tests/visualization_tests/test_contour.py
- [ ] tests/visualization_tests/matplotlib_tests/test_optimization_history.py
- [ ] tests/visualization_tests/test_pareto_front.py
- [ ] tests/visualization_tests/test_optimization_history.py
- [ ] tests/terminator_tests/improvement_tests/test_evaluator.py
- [ ] benchmarks/kurobako/problems/wfg/transformation_functions.py
- [ ] benchmarks/kurobako/problems/wfg/problem.py
- [ ] benchmarks/asv/optimize.py
- [ ] benchmarks/bayesmark/report_bayesmark.py
- [ ] benchmarks/bayesmark/optuna_optimizer.py
- [ ] benchmarks/run_bayesmark.py
- [ ] benchmarks/naslib/problem.py
- [ ] benchmarks/run_mo_kurobako.py


### Additional context (optional)

The above list is generated by the following script.

<details>
<summary>script</summary>

```python
import os
import pathlib


PATTERS = [
    "from typing import Union",
    "from typing import Optional",
    "from typing import Tuple",
    "from typing import List",
    "from typing import Dict",
    "from typing import Set",
    "from typing import FrozenSet",
    "from typing import Type",
    "from typing import FrozenSet",
]


def get_filenames_to_be_simplified(dir_path):
    ret = []
    for f in os.listdir(dir_path):
        file_path = os.path.join(dir_path, f)
        if not os.path.isfile(file_path):
            ret.extend(get_filenames_to_be_simplified(file_path))
        else:
            try:
                with open(file_path) as fd:
                    contents = fd.read()
                    if any([s in contents for s in PATTERS]):
                        ret.append(str(file_path))
            except UnicodeDecodeError as e:
                pass
    return ret


def main():
    dirs = ["optuna", "tests", "benchmarks"]

    for dir_name in dirs:
        filenames = get_filenames_to_be_simplified(pathlib.Path(dir_name))
        for filename in filenames:
            print(f"- [ ] {filename}")

if __name__ == "__main__":
    main()
```

</details>