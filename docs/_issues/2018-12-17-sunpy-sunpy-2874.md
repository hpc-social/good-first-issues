---
tags: ,Effort-Medium,Good-First-Issue,Hacktoberfest,Package-Novice,Priority-Medium,Tests
title: "Work towards mocking all the online tests in SunPy"
html_url: "https://github.com/sunpy/sunpy/issues/2874"
user: Cadair
repo: sunpy/sunpy
---

Currently much of SunPy's test coverage relies on remote servers, which can be unreliable and lead to spurious test failures on CI services.

Using the mock library: https://docs.python.org/3/library/unittest.mock.html and the pytest-mock plugin: https://github.com/pytest-dev/pytest-mock/ we should be able to massively increase the amount of our code which is run without remote servers, and then have an online test suite which checks for changes in the responses from the online servers, so we know if we need to update our code.

There is no fixed process. The idea is to replicate any test that has a `@pytest.mark.remote_data` decorator and use the mock library to replace the online response with a offline version.

The actual work/fix depends on the test, the best way to see how it works would be to look at tests already mocked, like the ones in `test_rhessi.py`.

Also for the record, it's worth pointing out that there should still be some online tests to detect changes to the remote services etc. The objective of this issue is to ensure that as much of the sunpy code is tested offline as possible. For the new online tests, the best thing to do is to test the mocks, i.e. if you mock the response to an API call, you want a test to check that that response does not change.

There is a fair amount of work in this issue, so more than one person can contribute to this, if you are going to take a stab at mocking out some tests, please leave a comment here saying which test files you are working on :smile: 

Done:
- test_noaa #2900

In Progress:

- None
 
On Hold:
- test_norh https://github.com/sunpy/sunpy/pull/2923
- test_goes_ud #2962
- test_eve #2961
- test_lyra_ud #2958

Not Done:

- Everything else. 